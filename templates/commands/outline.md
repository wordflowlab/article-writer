---
description: 框架约束模式写作(固定提纲扩展)
argument-hint: [模板名称或提纲文本]
allowed-tools: Read(//workspaces/**/brief.md, //workspaces/**/specification.md, //templates/outlines/**), Write(//workspaces/**/draft.md, //workspaces/**/outline.md, //workspaces/**/element-pool.yaml)
scripts:
  sh: scripts/bash/outline.sh
---

# /outline - 框架约束模式 ⭐ PRD-11

> **核心理念**: 用户提供固定框架，AI 按框架生成内容
> **适用场景**: 项目报告、开题报告、标书、技术方案
> **特点**: 框架严格固定 + 一致性检查

---

## 使用方式

### 方式 1：直接输入提纲

```
/outline

然后粘贴提纲文本
```

### 方式 2：使用预置模板

```
/outline --template project-proposal
/outline --template thesis-opening
/outline --template technical-report
```

### 方式 3：列出可用模板

```
/outline --list-templates
```

### 方式 4：保存为模板

```
/outline --save-template my-template
```

---

## 第一步：获取提纲

### 检查参数

**如果用户使用 `--list-templates`**：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 可用的提纲模板
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. project-proposal - 项目立项报告
   适用：科研项目、企业项目申报
   章节：7 个一级章节

2. thesis-opening - 开题报告
   适用：硕博开题
   章节：6 个一级章节

3. technical-report - 技术报告
   适用：技术方案、可行性分析
   章节：5 个一级章节

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

使用方式：
/outline --template project-proposal

或直接粘贴您自己的提纲文本。
```

→ **结束流程**，等待用户选择

---

**如果用户使用 `--template <name>`**：

```bash
# AI 操作：读取模板文件
Read templates/outlines/[name].yaml

# 提取模板内容
```

→ 跳转到"第二步：解析提纲"

---

**如果用户直接输入提纲文本**或**未提供参数**：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 框架约束模式
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请输入您的提纲框架：

支持格式：
- Markdown 层级（# 一级 ## 二级）
- 中文序号（一、二、（一）（二））
- 数字序号（1. 1.1 1.1.1）
- 纯文本缩进

示例：
一、概述
   （一）立项背景
   （二）申报依据
二、需求分析
三、研究方案
   （一）总体架构
   （二）技术路线

请粘贴您的提纲：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

→ **等待用户输入**

---

## 第二步：解析提纲

### 解析用户输入的提纲

**AI 操作**：分析提纲结构，识别层级

**支持的序号格式**：
- `一、二、三、...` → 一级
- `（一）（二）（三）...` 或 `(一)(二)...` → 二级
- `1. 2. 3. ...` 或 `1、2、3、...` → 三级
- `1.1 1.2 ...` → 二级
- `# ## ###` → Markdown 层级
- 缩进（2空格/4空格/Tab）→ 根据缩进判断层级

### 展示解析结果

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 提纲解析结果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

检测到 [X] 个一级章节，[X] 个二级章节，[X] 个三级章节：

├─ 一、概述
│  ├─ （一）立项背景
│  └─ （二）申报依据
├─ 二、需求分析
├─ 三、研究现状
├─ 四、主要研究内容及技术指标
│  ├─ （一）研究目标
│  ├─ （二）研究内容
│  └─ （三）技术指标
│       ├─ 1. 功能指标
│       └─ 2. 性能指标
├─ 五、研究方案
│  ├─ （一）总体架构
│  ├─ （二）系统流程
│  └─ （三）方案组成
│       ├─ 1. 软硬件资源分系统
│       ├─ 2. 数据治理分系统
│       └─ ...
├─ 六、经费预算
│  ├─ （一）硬件设备费
│  └─ （二）软件设备费
└─ 七、进度安排

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 统计：
- 一级章节：[X] 个
- 二级章节：[X] 个
- 三级章节：[X] 个
- 最大层级深度：[X] 级
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

这个结构正确吗？
- 回复"确认" - 继续下一步
- 回复"调整" - 告诉我哪里需要修改

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

→ **等待用户确认**

---

## 第三步：收集背景信息

### 自动识别文档类型

**AI 根据提纲特征判断文档类型**：

| 特征关键词 | 文档类型 |
|-----------|---------|
| 立项背景、申报依据、经费预算 | 项目立项报告 |
| 研究背景、文献综述、研究方法 | 开题报告 |
| 投标人资格、技术方案、报价 | 标书 |
| 技术背景、解决方案、实施计划 | 技术报告 |
| 发明内容、技术领域、权利要求 | 专利申请书 |

### 收集必要信息

**根据文档类型，收集相应的背景信息**：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📝 背景信息收集
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

检测到这是一份「[文档类型]」，请提供以下信息：

【必填项】

1. 项目名称：
   （全文统一使用的正式名称）

2. 项目简介：
   （一句话描述项目是做什么的）

3. 核心技术/方案：
   （项目采用的主要技术路线）

【选填项】

4. 执行单位/机构：
   （项目承担单位名称）

5. 预算范围：
   （如：500万元）

6. 时间周期：
   （如：2025年1月-2025年12月）

7. 其他专有名词：
   （需要在全文统一使用的术语，如：AI→人工智能）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💡 提示：
这些信息将用于保证全文一致性，
在各章节中自动使用统一的名称和术语。
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请逐项回答，或一次性提供所有信息：
```

→ **等待用户输入**

### 建立要素池

**AI 操作**：根据用户提供的信息，建立要素池

```yaml
# element-pool.yaml
properNouns:
  projectName: "XX智能应用系统平台"
  organizationName: "XX研究院"

dataStandards:
  timeRange: "2025年"
  currencyUnit: "万元"
  budget: "500"

terminology:
  AI: "人工智能"
  ML: "机器学习"
  LLM: "大语言模型"
```

**保存要素池**：
```bash
Write workspaces/[workspace]/articles/[project]/element-pool.yaml
```

---

## 第四步：章节类型识别

### AI 自动分析章节类型

**分类标准**：

**🤖 通用章节**（AI 可以自动生成）：
- 立项背景、行业分析、研究现状
- 申报依据、政策背景
- 进度安排、时间计划
- 标准格式的开头、结尾

**💬 核心章节**（需要用户补充信息）：
- 研究目标、研究内容
- 技术方案、系统设计、架构说明
- 经费预算、资源配置
- 创新点、核心价值
- 需要专业判断的部分

### 展示分类结果

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 章节类型识别
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

AI 已分析您的提纲，识别出以下分类：

🤖 通用章节（AI 自动生成）：
   ├─ 一、概述 > 立项背景
   ├─ 一、概述 > 申报依据
   ├─ 三、研究现状
   └─ 七、进度安排

💬 核心章节（需要您补充信息）：
   ├─ 二、需求分析
   ├─ 四、主要研究内容及技术指标
   │   ├─ 研究目标
   │   ├─ 研究内容
   │   └─ 技术指标
   ├─ 五、研究方案
   │   ├─ 总体架构
   │   ├─ 系统流程
   │   └─ 方案组成（6个分系统）
   └─ 六、经费预算

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 统计：
- 通用章节：[4] 个（AI 自动生成）
- 核心章节：[10] 个（需要您参与）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

这个分类合适吗？
- 回复"开始" - 开始逐章节生成
- 回复"调整" - 告诉我哪些章节的分类需要调整
  例如："把'需求分析'改为通用章节"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

→ **等待用户确认或调整**

---

## 第五步：逐章节生成

### 生成流程

按提纲顺序，逐章节生成内容。

### 通用章节处理

**对于标记为"通用章节"的内容**：

1. **AI 自动生成**：
   - 基于要素池中的信息
   - 使用专业的行业表达
   - 保持术语一致性

2. **展示生成结果**：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📝 章节生成 [1/14]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

章节：一、概述 > （一）立项背景
类型：🤖 通用章节（AI 自动生成）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[AI 生成的内容]

随着人工智能技术的快速发展，特别是大语言模型（LLM）
在各领域的广泛应用，XX研究院积极响应国家"十四五"
规划中关于人工智能发展的战略部署...

[约 300-500 字的立项背景描述]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 一致性检查：
- 项目名称：使用"XX智能应用系统平台" ✓
- 机构名称：使用"XX研究院" ✓
- 术语统一：AI→人工智能 ✓

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

操作选项：
- ✅ 确认 - 保存并继续下一章节
- ✏️ 修改 - 告诉我需要修改的地方
- 🔄 重新生成 - 重新生成此章节

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

→ **等待用户选择**

### 核心章节处理

**对于标记为"核心章节"的内容**：

1. **AI 提问收集信息**：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📝 章节生成 [5/14]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

章节：四、主要研究内容及技术指标 > （一）研究目标
类型：💬 核心章节（需要您补充信息）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

这是核心章节，需要您提供专业信息。

请回答以下问题：

1. 项目的总体目标是什么？
   （一句话概括项目要达成的最终效果）

2. 有哪些具体目标？
   （分条列出，如：建设XX平台、实现XX功能、达到XX指标）

3. 预期的量化指标是什么？
   （如：支持XX并发、准确率达到XX%）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请回答以上问题，我会基于您的回答生成此章节：
```

→ **等待用户回答**

2. **基于用户回答生成内容**：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📝 章节生成 [5/14] - 生成结果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

基于您提供的信息，生成内容如下：

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

（一）研究目标

本项目的总体目标是：构建一套基于大语言模型的智能应用
系统平台，实现[用户提供的目标描述]...

具体目标包括：

1. [基于用户输入整理的具体目标1]
2. [基于用户输入整理的具体目标2]
3. [基于用户输入整理的具体目标3]

量化指标：
- [用户提供的指标1]
- [用户提供的指标2]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 一致性检查：
- 项目名称一致 ✓
- 术语统一 ✓
- 与前文"立项背景"逻辑呼应 ✓

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

操作选项：
- ✅ 确认 - 保存并继续下一章节
- ✏️ 修改 - 告诉我需要修改的地方
- 🔄 重新生成 - 重新提供信息并生成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

→ **等待用户选择**

### 进度显示

每个章节处理后，显示整体进度：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 生成进度：[5/14] 36%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

已完成：
✅ 一、概述 > 立项背景
✅ 一、概述 > 申报依据
✅ 二、需求分析
✅ 三、研究现状
✅ 四、研究目标 ← 刚完成

进行中：
→ 四、研究内容

待完成：
○ 四、技术指标
○ 五、研究方案（4个子章节）
○ 六、经费预算（2个子章节）
○ 七、进度安排

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
继续下一章节...
```

---

## 第六步：全局一致性检查

### 所有章节完成后，执行全局检查

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 全局一致性检查
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

全文已生成完毕，正在执行一致性检查...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 通过项 (5/7)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 项目名称一致性
   - "XX智能应用系统平台" 出现 [12] 次
   - 全部统一 ✓

✅ 机构名称一致性
   - "XX研究院" 出现 [6] 次
   - 全部统一 ✓

✅ 术语统一
   - AI → 人工智能 (已替换 [8] 处)
   - LLM → 大语言模型 (已替换 [5] 处)

✅ 时间范围一致
   - 项目周期：2025年1月-2025年12月
   - 进度安排与此一致 ✓

✅ 框架完整性
   - 所有 [14] 个章节已覆盖
   - 无遗漏 ✓

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ 警告项 (2/7)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ 数据口径不一致
   - 第三章"研究现状"：市场规模 500 亿
   - 第一章"立项背景"：市场规模 480 亿
   → 位置：第三章第2段
   → 建议：统一为 500 亿（更新数据）

⚠️ 经费预算核算
   - 总预算：500 万元
   - 分项合计：480 万元
   - 差额：20 万元
   → 位置：第六章经费预算表
   → 建议：调整分项或说明预留经费

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 检查总结
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

一致性评分：85/100

- 通过：5 项
- 警告：2 项
- 错误：0 项

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

操作选项：

1. 🔧 修复警告 - 逐个处理警告项
2. ⏭️ 忽略继续 - 保存当前版本
3. 📄 查看全文 - 预览完整文档

请选择 1/2/3：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

→ **等待用户选择**

### 修复警告

如果用户选择"修复警告"：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔧 修复警告 [1/2]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ 问题：数据口径不一致

当前情况：
- 第一章：市场规模 480 亿
- 第三章：市场规模 500 亿

请选择处理方式：
1. 统一为 500 亿（更新数据）
2. 统一为 480 亿
3. 保持不同（添加说明：截至不同时间点）
4. 忽略此警告

请选择 1/2/3/4：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 第七步：保存文档

### 保存最终版本

```bash
# AI 操作：保存草稿
Write workspaces/[workspace]/articles/[project]/draft.md

# 保存提纲
Write workspaces/[workspace]/articles/[project]/outline.md

# 保存一致性报告
Write workspaces/[workspace]/articles/[project]/consistency-report.md
```

### 完成提示

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 框架约束模式写作完成！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📄 已生成文件：

1. draft.md - 完整文档
   - 总字数：[8500] 字
   - 章节数：[14] 个

2. outline.md - 提纲文件
   - 可用于后续复用

3. consistency-report.md - 一致性报告
   - 评分：[92]/100

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 统计信息：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

- 通用章节（AI 生成）：[4] 个，约 [2500] 字
- 核心章节（协作生成）：[10] 个，约 [6000] 字
- AI 生成比例：约 [30]%
- 预估 AI 检测率：[22-28]%

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💡 下一步操作
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

a) /review style - 风格审校
   说明：优化表达，降低 AI 味

b) /check - 最终检查
   说明：检查格式、字数、完整性

c) /outline --save-template [名称]
   说明：将当前提纲保存为模板，方便复用

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⭐ 推荐：执行 a) /review style 优化文档质量
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 模板管理

### 保存为模板

**如果用户使用 `--save-template <name>`**：

1. **读取当前 outline.md**
2. **转换为模板格式**
3. **保存到 templates/outlines/**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💾 保存模板
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

模板名称：[name]
来源文件：outline.md

请提供模板描述（一句话说明适用场景）：
```

→ **等待用户输入描述**

```
✅ 模板已保存！

文件：templates/outlines/[name].yaml

使用方式：
/outline --template [name]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 一致性检查规则

### 检查维度

1. **专有名词一致性**
   - 项目名称在全文中必须完全一致
   - 机构名称统一（不能混用简称和全称）
   - 产品名称统一

2. **术语统一**
   - 按要素池中的术语表替换
   - 检查是否有遗漏的替换

3. **数据口径**
   - 同一数据在不同位置的引用是否一致
   - 金额单位是否统一
   - 时间表述是否一致

4. **章节间逻辑**
   - 研究目标与研究内容是否对应
   - 技术指标与研究方案是否匹配
   - 经费预算与实施计划是否合理

5. **框架完整性**
   - 所有提纲章节是否都已覆盖
   - 是否有多余的章节

### 检查级别

- **❌ 错误**：必须修复才能保存
- **⚠️ 警告**：建议修复，可以忽略
- **ℹ️ 信息**：仅供参考

---

## 与现有流程的集成

### 流程入口

框架约束模式可以通过以下方式进入：

1. **直接调用**：`/outline`
2. **从 /specify 引导**：当用户表示"已有框架"时推荐
3. **从 /write 引导**：选择"模式 4"时跳转

### 与其他命令的关系

| 命令 | 框架约束模式下的使用 |
|------|-------------------|
| `/specify` | 可选（可以收集背景信息） |
| `/topic` | **跳过**（框架已固定） |
| `/research` | 可选（为章节收集素材） |
| `/collect` | 可选（补充真实案例） |
| `/outline` | **核心命令** |
| `/review` | 建议执行（优化表达） |
| `/check` | 建议执行（最终检查） |
| `/publish` | 正常使用 |

---

## 常见问题

### Q1: 框架约束模式和混合模式有什么区别？

**A**:
- **混合模式**：框架由 AI 生成，用户可以调整
- **框架约束模式**：框架由用户提供，严格固定不可改

### Q2: 如何保证各章节之间的一致性？

**A**:
- 第三步收集背景信息时建立"要素池"
- 每个章节生成时自动引用要素池
- 第六步执行全局一致性检查

### Q3: 可以在生成过程中修改提纲吗？

**A**:
- 框架约束模式下，提纲严格固定
- 如需修改提纲，建议重新开始 `/outline`
- 或者使用混合模式（支持框架调整）

### Q4: 生成的内容不满意怎么办？

**A**:
- 每个章节都支持"修改"和"重新生成"
- 核心章节可以重新提供信息
- 完成后可以用 `/review` 进一步优化

### Q5: 如何复用已有的提纲？

**A**:
- 使用 `/outline --save-template <name>` 保存为模板
- 下次使用 `/outline --template <name>` 调用

---

**核心原则**：用户提供框架，AI 按框架生成，全程保证一致性。
