# PRD-11: 框架约束模式

**版本**: v1.0
**创建时间**: 2025-11-27
**状态**: 实施中
**作者**: Claude Code Assistant

---

## 📋 背景与问题

### 用户反馈

群友提出了一个高频需求场景：

> "领导给我列好了提纲，不需要 AI 列提纲，我只需要按照提纲补充内容"

> "这种框架会有很多，需要根据不同领域、不同体系、不同渠道、不同用户的要求，进行调整或直接套用"

### 典型场景

1. **领导给定提纲**：下属按提纲补充内容
2. **强框架约束文档**：
   - 项目立项报告（公司/科研机构模板）
   - 开题报告（学校格式要求）
   - 标书（招标文件格式）
   - 专利申请书（国知局格式）
   - 技术方案（客户指定结构）
3. **弱框架约束**：客户给几个要点，基于要点拟制方案

### 真实案例

群友提供的立项报告提纲：

```
《基于大语言模型的 XX 智能应用系统平台 - 立项方案》

一、概述
   （一）立项背景
   （二）申报依据
二、需求分析
三、研究现状
四、主要研究内容及技术指标
   （一）研究目标
   （二）研究内容
   （三）技术指标
        1. 功能指标
        2. 性能指标
五、研究方案
   （一）总体架构
   （二）系统流程
   （三）方案组成
        1. 软硬件资源分系统
        2. 数据治理分系统
        3. 知识管理与构建分系统
        4. 模型微调训练分系统
        5. 服务工具分系统
        6. 智能应用分系统
六、经费预算
   （一）硬件设备费
   （二）软件设备费
七、进度安排
```

### 当前设计的局限

**现有三种模式的问题**：
- ✅ 教练模式：AI 提问引导，但框架由 AI 建议
- ✅ 快速模式：AI 生成全文，但框架由 AI 决定
- ✅ 混合模式：AI 写框架，但框架可以调整

**用户需求**：
- ❌ 框架由用户/领导/客户提供，不可随意修改
- ❌ 框架是严格固定的，各章节必须对应
- ❌ 需要保证全文一致性（术语、人名、数据口径统一）

---

## 🎯 设计目标

### 核心目标

**新增第四种写作模式：框架约束模式**

1. ✅ **接受用户提供的固定框架**：框架来源于用户，不可随意修改
2. ✅ **智能识别章节类型**：区分通用章节和核心章节
3. ✅ **逐章节生成内容**：按框架顺序生成，每章可确认/修改
4. ✅ **一致性检查**：保证全文术语、数据、人名统一
5. ✅ **模板库支持**：预置常用框架模板，支持用户保存自定义模板

### 非目标

- ❌ 不是要替代现有三种模式
- ❌ 不是让用户完全不参与创作
- ❌ 不是要生成完全格式化的公文

---

## 🎨 方案设计

### 模式对比

| 维度 | 教练模式 | 快速模式 | 混合模式 | **框架约束模式(新)** |
|------|---------|---------|---------|-------------------|
| **AI 角色** | 教练 | 助手 | 协作者 | **执行者** |
| **AI 生成比例** | 0% | 100% | 40% | **60-80%** |
| **框架来源** | AI 建议 | AI 生成 | AI 生成 | **用户提供** |
| **框架可调** | 可调 | 可调 | 可调 | **严格固定** |
| **时间投入** | 3-4 小时 | 1-2 小时 | 2-3 小时 | **1.5-3 小时** |
| **AI 检测率** | < 15% | 25-40% | 18-25% | **20-35%** |
| **适用场景** | 个人经历文 | 信息整理 | 教程类 | **强约束文档** |

### 用户体验流程

```
/specify → 检测到"框架约束"需求
    ↓
/outline (新命令)
    ↓
    ├─ Step 1: 输入提纲（文本/模板）
    ├─ Step 2: 收集背景信息（项目名、技术路线等）
    ├─ Step 3: AI 识别章节类型
    │   ├─ 通用章节 → 自动生成
    │   └─ 核心章节 → 交互式询问
    ├─ Step 4: 逐章节生成/确认
    └─ Step 5: 全局一致性检查
    ↓
/review → /check → /publish
```

### 新增命令：`/outline`

**功能**：一站式提纲输入 + 内容生成

**交互流程**：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 框架约束模式
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【Step 1】请输入您的提纲框架：

方式1: 直接粘贴提纲文本
方式2: 使用模板 → /outline --template project-proposal
方式3: 查看可用模板 → /outline --list-templates

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【Step 2】背景信息收集

检测到这是一份「项目立项报告」，请提供：

1. 项目名称：_________
2. 项目简介（一句话）：_________
3. 核心技术/方案：_________
4. 预算范围：_________
5. 时间周期：_________

（可选）上传参考材料：_________

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【Step 3】章节类型识别

AI 已分析您的提纲，识别出：

🤖 通用章节（AI 自动生成）：
   - 一、概述 > 立项背景
   - 一、概述 > 申报依据
   - 三、研究现状
   - 七、进度安排

💬 核心章节（需要您补充信息）：
   - 四、主要研究内容及技术指标
   - 五、研究方案
   - 六、经费预算

开始生成？(yes/调整分类)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【Step 4】逐章节生成

正在生成「一、概述 > 立项背景」...

[生成结果]

✅ 确认 / ✏️ 修改 / 🔄 重新生成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【Step 5】全局一致性检查

全文生成完成，正在检查一致性...

✅ 项目名称：统一使用「XX智能应用系统平台」(出现12次)
✅ 术语一致：AI → 人工智能
⚠️ 警告：经费预算总额(500万)与分项合计(480万)不一致
   → 位置：六、经费预算
   → 建议：调整分项或总额

修复问题后生成最终文档？
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 章节类型识别

**通用章节**（AI 自动生成）：
- 立项背景、申报依据
- 研究现状、行业分析
- 进度安排、时间计划
- 标准格式的开头/结尾

**核心章节**（需要用户补充信息）：
- 研究目标、研究内容
- 技术方案、系统设计
- 经费预算、资源配置
- 需要专业判断的部分

### 一致性检查机制

**检查维度**：
1. **专有名词一致性**：项目名称、机构名称、产品名称
2. **术语统一**：AI/人工智能、ML/机器学习
3. **数据口径**：金额单位（万元/元）、时间范围
4. **章节间逻辑**：目标↔内容↔预算对应关系

**检查时机**：
- **章节级检查**：每个章节生成后，轻量检查
- **全局检查**：全文完成后，深度检查 + 生成报告

### 模板库系统

**预置模板**：

| 模板 ID | 名称 | 适用场景 |
|---------|------|---------|
| `project-proposal` | 项目立项报告 | 科研/企业项目申报 |
| `thesis-opening` | 开题报告 | 硕博开题 |
| `technical-report` | 技术报告 | 技术方案、可行性分析 |

**模板结构**：
```yaml
id: project-proposal
name: 项目立项报告
description: 适用于科研项目、企业项目的立项申报
structure:
  - title: 一、概述
    type: auto  # 通用章节
    children:
      - title: （一）立项背景
        type: auto
      - title: （二）申报依据
        type: auto
  - title: 二、需求分析
    type: interactive  # 核心章节
required_info:
  - key: projectName
    label: 项目名称
    required: true
  - key: projectSummary
    label: 项目简介
    required: true
```

**模板管理**：
- `/outline --list-templates`：列出可用模板
- `/outline --template <id>`：使用指定模板
- `/outline --save-template <name>`：保存当前提纲为模板

---

## 🔄 流程调整

### 调整点 1: `/specify` 命令

**新增功能：框架来源识别**

在 brief 收集阶段，增加框架来源判断：

```markdown
## 框架来源 ⭐ 新增

您的文章框架从哪里来？

a) 🤖 AI 建议框架（可调整）
   - 适合：自由创作、个人文章
   - 流程：/specify → /topic → /write

b) 📋 我已有框架（固定不可改）
   - 适合：项目报告、开题报告、标书
   - 流程：/specify → /outline

c) 📝 我有几个要点（弱约束）
   - 适合：要点方案、回复报告
   - 流程：/specify → /outline
```

### 调整点 2: `/write` 命令

**新增模式 4 入口**：

```
请选择写作模式:

  1. 🎓 教练模式 - AI 引导你自己写每一段
  2. ⚡ 快速模式 - AI 生成初稿，你审校修改
  3. 🔄 混合模式 - AI 写框架，你填关键细节
  4. 📋 框架约束模式 - 你给框架，AI 填内容 ⭐ 新增
     适合: 项目报告、开题报告、标书、专利
     时间: 1.5-3 小时 | AI 检测率: 20-35%
```

---

## 📊 用户场景

### 场景 1: 科研项目立项报告

**背景**：
- 领导给了提纲，格式固定
- 需要填充各章节内容
- 要求术语统一、数据一致

**推荐流程**：
```
/specify → /outline (使用 project-proposal 模板)
  ↓
逐章节生成 → 一致性检查 → /review → /publish
```

### 场景 2: 硕士开题报告

**背景**：
- 学校有固定格式要求
- 研究背景、文献综述可以 AI 辅助
- 研究方法、创新点需要自己写

**推荐流程**：
```
/specify → /outline (使用 thesis-opening 模板)
  ↓
通用章节自动生成 → 核心章节交互填写 → /review
```

### 场景 3: 技术方案文档

**背景**：
- 客户给了要点要求
- 需要按要点展开技术方案
- 时间紧急，1-2 小时完成

**推荐流程**：
```
/specify → /outline (自定义提纲)
  ↓
快速生成 → 一致性检查 → /check → 交付
```

---

## 📝 文件修改清单

### 1. `templates/commands/outline.md` ⭐ 新增

**功能**：
- 提纲输入（文本/模板）
- 背景信息收集
- 章节类型识别
- 逐章节生成 + 确认
- 一致性检查

**预计行数**：约 400 行

### 2. `templates/commands/specify.md` 修改

**改动**：
- 新增"框架来源"识别逻辑
- 用户选择"已有框架"时，推荐 `/outline`

**预计修改量**：约 30 行

### 3. `templates/commands/write.md` 修改

**改动**：
- 在模式选择界面增加第 4 种模式
- 选择模式 4 时，提示使用 `/outline`

**预计修改量**：约 20 行

### 4. `templates/outlines/` 目录 ⭐ 新增

**预置模板**：
- `project-proposal.yaml` - 项目立项报告
- `thesis-opening.yaml` - 开题报告
- `technical-report.yaml` - 技术报告

### 5. `docs/outline-mode/` 目录 ⭐ 新增

**使用教程**：
- `README.md` - 功能概述
- `quick-start.md` - 快速上手
- `templates-guide.md` - 模板使用指南
- `best-practices.md` - 最佳实践

---

## ⚠️ 风险与应对

### 风险 1: 框架解析不准确

**问题**：复杂层级结构解析错误

**应对**：
- 提供解析结果确认步骤
- 支持用户手动调整层级
- 支持多种输入格式（Markdown、纯文本）

### 风险 2: 一致性检查误报

**问题**：正常表述被标记为不一致

**应对**：
- 提供"忽略"选项
- 区分 error/warning/info 级别
- 允许用户配置例外规则

### 风险 3: AI 生成内容质量不高

**问题**：生成内容与专业领域不符

**应对**：
- 核心章节采用交互式生成
- 每章节支持修改/重新生成
- 集成三遍审校机制

### 风险 4: 长文档一致性难维护

**问题**：万字以上文档要素太多

**应对**：
- 自动追踪已使用要素
- 提供要素使用统计
- 章节间引用检查

---

## 📈 成功指标

### 用户体验指标

1. **功能使用率**：框架约束模式使用占比 > 15%
2. **完整流程完成率**：> 85%
3. **用户满意度**：4.5/5.0

### 质量指标

1. **一致性检查通过率**：首次生成 > 80% 通过
2. **AI 检测率达标**：> 80% 文章 AI 检测率 < 35%
3. **返工率**：< 20%（章节重新生成次数）

---

## 🎉 预期效果

### 解决的问题

1. ✅ **支持固定框架场景**：领导给的提纲可以直接使用
2. ✅ **模板复用**：常用框架可以保存为模板
3. ✅ **一致性保证**：自动检查全文术语、数据统一
4. ✅ **效率提升**：通用章节自动生成，节省时间

### 覆盖的用户群体

1. ✅ **政企用户**：需要写各类报告、方案
2. ✅ **科研人员**：开题报告、项目申请
3. ✅ **商务人员**：标书、技术方案
4. ✅ **学生群体**：论文、报告

---

## 🚀 实施计划

### 实施清单

1. ✅ 创建 PRD 文档
2. ⬜ 创建 `/outline` 命令模板
3. ⬜ 修改 `/specify` 命令
4. ⬜ 修改 `/write` 命令
5. ⬜ 创建模板库和预置模板
6. ⬜ 创建使用教程文档

---

## 附录：常见问题

### Q1: 框架约束模式和混合模式有什么区别？

**A**:
- **混合模式**：框架由 AI 生成，可以调整
- **框架约束模式**：框架由用户提供，严格固定

### Q2: 如何保证不同章节之间的一致性？

**A**:
- 收集背景信息时建立"要素池"（专有名词、术语表、数据口径）
- 每个章节生成时引用要素池
- 全文完成后进行一致性检查

### Q3: 可以在生成过程中修改框架吗？

**A**:
- 框架约束模式下，框架严格固定
- 如需修改框架，建议重新开始 `/outline`
- 或者使用混合模式，支持框架调整

### Q4: 模板可以自定义吗？

**A**:
- 可以使用 `/outline --save-template <name>` 保存自定义模板
- 模板保存在 `templates/outlines/` 目录
- 下次可以通过 `/outline --template <name>` 复用

---

**结语**

框架约束模式填补了现有三种模式的空白，专门服务于"框架固定、内容填充"的场景。这类场景在政企、科研、商务领域非常常见，是真实的高频需求。

通过智能识别章节类型、自动生成通用内容、交互式填写核心内容、全局一致性检查，我们可以大幅提升这类文档的撰写效率，同时保证内容质量。
